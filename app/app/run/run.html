<div class="row">
  <div class="col-sm-1 pad-bot-10">
    <h4 translate>run.title</h4>
  </div>
  <div class="col-sm-2 pad-bot-20 pad-top-5">
    <div class="input-group">
      <select class="form-control" ng-options="type.displayName for type in run.runTypes track by type.name" ng-model="selectedRunType" ng-change="run.setRunType()"></select>
    </div>
  </div>
  <div class="col-sm-5 pad-bot-20 pad-top-10">
    <div class="tab-text">Server Status&nbsp;
      <span ng-show="serverStatus=='started'" class="glyphicon glyphicon-ok green-button" aria-label="started"></span>
      <span ng-show="serverStatus!='started'" class="glyphicon glyphicon-remove red-button" aria-label="stopped"></span>
   </div>
  </div>
</div>

<div ng-show="selectedRunType.name == 'remote'" class="row pad-bot-20">
  <div class="col-md-8">
    <button type="button" class="btn btn-info" ng-click="run.exportOSA()" translate>run.exportToOSA</button>
    <button type="button" class="btn btn-success" ng-show="!disabledButtons" ng-click="run.runEntireWorkflow()" translate>run.runEntireWorkflow</button>
    <button type="button" class="btn btn-danger" ng-show="disabledButtons && serverStatus == 'started'" ng-click="run.cancelRun()" translate>run.cancelRun</button>
    <button type="button" class="btn btn-primary" ng-show="serverStatus == 'started'" ng-click="run.viewServer()">View Server</button>
  </div>
</div>

<div ng-show="selectedRunType.name == 'local'" class="row pad-bot-20">
  <div class="col-md-12">
    <button type="button" class="btn btn-info" ng-click="run.exportOSA()" translate>run.exportToOSA</button>
    <button type="button" class="btn btn-success" ng-show="!disabledButtons" ng-click="run.runEntireWorkflow()" translate>run.runEntireWorkflow</button>
    <button type="button" class="btn btn-danger" ng-show="disabledButtons" ng-click="run.cancelRun()" translate>run.cancelRun</button>
    <button type="button" class="btn btn-danger" ng-show="serverStatus == 'started'" ng-click="run.stopServer()" translate>run.stopServer</button>
    <button type="button" class="btn btn-primary" ng-show="serverStatus == 'started'" ng-click="run.viewServer()">View Server</button>
    <!-- <button type="button" class="btn btn-success" ng-disabled="disabledButtons" ng-click="run.runSelected()">Run Selected</button>
      <button type="button" class="btn btn-success" ng-disabled="disabledButtons" ng-click="run.runUpdated()">Run Updated Design Alternatives Only</button>
      <button type="button" class="btn btn-success" ng-disabled="disabledButtons" ng-click="run.runEnergyPlus()">Run up to EnergyPlus</button>
      <button type="button" class="btn btn-success" ng-disabled="disabledButtons" ng-click="run.runReportingMeasures()">Run Reporting Measures</button>
      -->
  </div>
</div>

<div class="row">
  <div class="col-sm-6">
    <uib-progressbar class="progress-striped active" type="success" value="progress.amount">{{progress.message}}</uib-progressbar>
  </div>
</div>

<div ng-show="analysisID != undefined">
  <div class="row row-borders">
    <div class="col-sm-6 tab-text">
       <label>Analysis ID</label> {{analysisID}}
    </div>
    <div class="col-sm-4 tab-text" ng-if="analysisStatus != ''">
      <label>Status</label> {{analysisStatus}}
    </div>
  </div>
</div>

<div ng-if="datapoints.length > 0" class="run-datapoints">
  <div class="row datapoint-header">
    <div class="col-sm-2">Name</div>
    <div class="col-sm-2">Last Run</div>
    <div class="col-sm-1">Run Time</div>
    <div class="col-sm-2">Status</div>
    <div class="col-sm-1">NAs</div>
    <div class="col-sm-1">Warnings</div>
    <div class="col-sm-1">Errors</div>
    <div class="col-sm-1"><span class="badge white-badge">C</span> All</div>
    <div class="col-sm-1"></div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <uib-accordion close-others="false">
        <uib-accordion-group ng-repeat="datapoint in datapoints" id="{{datapoint.id}}" is-open="datapoint.open">
          <uib-accordion-heading>
            <div class="row">
              <div class="col-sm-2">
                <i class="pull-left glyphicon pad-right-5 black-button" ng-class="{'glyphicon-chevron-down': datapoint.open, 'glyphicon-chevron-right': !datapoint.open}"></i>
                {{datapoint.name}}
              </div>
              <div class="col-sm-2">{{run.extractDate(datapoint.updated_at)}}</div>
              <div class="col-sm-1">{{run.getRunTime(datapoint.started_at, datapoint.completed_at)}}</div>
              <div class="col-sm-2 green-text">{{datapoint.status}}</div>
              <div class="col-sm-1"></div>
              <div class="col-sm-1"><span class="badge orange-badge square-badge">{{run.calculateWarnings(datapoint)}}</span></div>
              <div class="col-sm-1"><span class="badge red-badge square-badge">{{run.calculateErrors(datapoint)}}</span></div>
              <div class="col-sm-1">&nbsp;&nbsp;<span class="badge orange-badge">C</span></div>
              <div class="col-sm-1"><img ng-src="assets/images/ReportingMeasure_icon_grayed.png" alt="Datapoint Still Running" ng-show="datapoint.downloaded_reports != true" />
                <img ng-src="assets/images/ReportingMeasure_icon.png" alt="View Reports for datapoint {{datapoint.name}}" ng-show="datapoint.downloaded_reports" ng-click="run.viewReports()" /></div>
            </div>
           <!-- <i class="pull-left glyphicon pad-right-5 black-button" ng-class="{'glyphicon-chevron-down': datapoint.open, 'glyphicon-chevron-right': !datapoint.open}"></i>
            {{datapoint.name}} - status: {{datapoint.status}} - {{datapoint.final_message}}-->
          </uib-accordion-heading>
          <div class="run-measures"></div>
            <div class="panel panel-default full-width no-border">
              <div class="panel-body run-measures">
                <uib-accordion close-others="false">
                  <uib-accordion-group ng-repeat="step in datapoint.steps" id="{{datapoint.id}}-{{step.name}}" is-open="step.open">
                    <uib-accordion-heading>
                      <div class="row measure-accordion">
                        <div class="col-sm-2 bold">{{step.name}}</div>
                        <div class="col-sm-2">{{run.extractDate(step.result.started_at)}}</div>
                        <div class="col-sm-1">{{run.getRunTime(step.result.started_at, step.result.completed_at)}}</div>
                        <div class="col-sm-2"></div>
                        <div class="col-sm-1"></div>
                        <div class="col-sm-1"><span class="badge orange-badge square-badge">{{step.result.step_warnings.length}}</span></div>
                        <div class="col-sm-1"><span class="badge red-badge square-badge">{{step.result.step_errors.length}}</span></div>
                        <div class="col-sm-1"></div>
                        <div class="col-sm-1"></div>
                      </div>
                    </uib-accordion-heading>
                    <div class="measure-accordion-body">
                      <label>Initial Condition: </label> {{step.result.initial_condition}}<br/>
                      <label>Final Condition: </label> {{step.result.final_condition}}<br/>
                    </div>
                  </uib-accordion-group>
                </uib-accordion>
              </div>
            </div>
          </div>
        </uib-accordion-group>
      </uib-accordion>
    </div>
  </div>
</div>

<div class="row pad-top-100">
  <div class="col-sm-10">
    <uib-accordion>
      <uib-accordion-group is-open="dev.open">
        <uib-accordion-heading>
          <i class="pull-left glyphicon pad-right-5 black-button" ng-class="{'glyphicon-chevron-down': dev.open, 'glyphicon-chevron-right': !dev.open}"></i>
          Server Troubleshooting
        </uib-accordion-heading>
        <button type="button" class="btn btn-danger" ng-click="run.startServer(true)">Force Server START </button>
        <button type="button" class="btn btn-danger" ng-click="run.stopServer(true)">Force Server STOP </button>
        <button type="button" class="btn btn-primary" ng-click="run.pingServer()">Ping Server and Set Status</button>
      </uib-accordion-group>
    </uib-accordion>
  </div>
</div>


